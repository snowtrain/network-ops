{% extends 'base.html' %}

{% block head %}
    {% load static %}
    <!-- DataTables -->
    <link rel="stylesheet" href="{% static 'plugins/datatables/dataTables.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/datatables/buttons.bootstrap4.min.css' %}">
{% endblock head %}

{% block js %}
    {% load static %}
    <!-- Required datatable js -->
    <script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'plugins/datatables/dataTables.bootstrap4.min.js' %}"></script>

    <!-- Buttons examples -->
    <script src="{% static 'plugins/datatables/dataTables.buttons.min.js' %}"></script>
    <script src="{% static 'plugins/datatables/buttons.bootstrap4.min.js' %}"></script>
    <script src="{% static 'plugins/datatables/jszip.min.js' %}"></script>
    <script src="{% static 'plugins/datatables/pdfmake.min.js' %}"></script>
    <script src="{% static 'plugins/datatables/vfs_fonts.js' %}"></script>
    <script src="{% static 'plugins/datatables/buttons.html5.min.js' %}"></script>
    <script src="{% static 'plugins/datatables/buttons.print.min.js' %}"></script>
{% endblock js %}

{% block body %}
    <div class="container-fluid">

        <div class="content-page">

            <!-- Top Bar Start -->
            <div class="topbar">

                <div class="row">
                    <div class="col-12">
                        <div class="card-box table-responsive">
                                <h4 class="m-t-0 header-title">设备列表</h4>
                            <p class="text-muted font-14 m-b-30">
                                等待编辑！
                            </p>

                            <table id="datatable-buttons" class="table table-striped table-bordered" cellspacing="0"
                                   width="100%">
                                <thead class="thead-dark">
                                <tr>
                                    <th scope="col"  style="text-align:center;">#</th>
                                    <th scope="col"  style="text-align:center;">设备名</th>
                                    <th scope="col"  style="text-align:center;">IP地址</th>
                                    <th scope="col"  style="text-align:center;">SNMP采集</th>
                                    <th scope="col"  style="text-align:center;">SSH登录</th>
                                    <th scope="col"  style="text-align:center;">CPU最大利用率</th>
                                    <th scope="col"  style="text-align:center;">CPU当前利用率</th>
                                    <th scope="col"  style="text-align:center;">MEM最大利用率</th>
                                    <th scope="col"  style="text-align:center;">MEM当前利用率</th>
                                    <th scope="col"  style="text-align:center;">接口在用个数</th>
                                    <th scope="col"  style="text-align:center;">操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for device in devices_list %}
                                    <tr>
                                        {# 通过forloop.counter来显示行号,请注意这个不是设备唯一ID #}
                                        <th scope="row" align="center" valign="center">{{ forloop.counter }}</th>
                                        {# 判断设备可达性, 并且替换不同的字体颜色 #}
                                        {% if device.snmp_reachable is True and device.ssh_reachable is True %}
                                            <td align="center" valign="center" style="color:green">
                                                <strong>{{ device.name }}</strong></td>
                                        {% elif device.snmp_reachable is False and device.ssh_reachable is False %}
                                            <td align="center" valign="center" style="color:red">
                                                <strong>{{ device.name }}</strong></td>
                                        {% else %}
                                            <td align="center" valign="center" style="color:darkorange">
                                                <strong>{{ device.name }}</strong></td>
                                        {% endif %}

                                        {# 设备IP地址 #}
                                        <td align="center" valign="center">{{ device.ip }}</td>

                                        {# 通过判断SNMP可达性, 替换不同的背景颜色 #}
                                        {% if device.snmp_reachable == '正常' %}
                                            <td style="background-color: greenyellow" align="center"
                                                valign="center">{{ device.snmp_reachable }}</td>
                                        {% else %}
                                            <td style="background-color:red" align="center"
                                                valign="center">{{ device.snmp_reachable }}</td>
                                        {% endif %}

                                        {# 通过判断SSH可达性, 替换不同的背景颜色 #}
                                        {% if device.ssh_reachable == '正常' %}
                                            <td style="background-color:greenyellow" align="center"
                                                valign="center">{{ device.ssh_reachable }}</td>
                                        {% else %}
                                            <td style="background-color:red" align="center"
                                                valign="center">{{ device.ssh_reachable }}</td>
                                        {% endif %}

                                        {# 根据最大CPU利用率, 调整进度条颜色与长度 #}
                                        {% if device.cpu_max >= 70 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    {# progress-bar为进度条, bg-danger为颜色, width为长度, <div>中间</div>为进度条内显示的内容 #}
                                                    <div class="progress-bar progress-bar-striped bg-danger"
                                                         role="progressbar" style="width: {{ device.cpu_max }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.cpu_max }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% elif device.cpu_max >= 30 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-warning"
                                                         role="progressbar" style="width: {{ device.cpu_max }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.cpu_max }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% elif device.cpu_max >= 0 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-success"
                                                         role="progressbar" style="width: {{ device.cpu_max }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.cpu_max }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% else %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-danger"
                                                         role="progressbar" style="width: 100%" aria-valuenow="25"
                                                         aria-valuemin="0" aria-valuemax="100">{{ device.cpu_max }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% endif %}

                                        {# 根据当前CPU利用率, 调整进度条颜色与长度 #}
                                        {% if device.cpu_current >= 70 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    {# progress-bar为进度条, bg-danger为颜色, width为长度, <div>中间</div>为进度条内显示的内容 #}
                                                    <div class="progress-bar progress-bar-striped bg-danger"
                                                         role="progressbar" style="width: {{ device.cpu_current }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.cpu_current }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% elif device.cpu_current >= 30 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-warning"
                                                         role="progressbar" style="width: {{ device.cpu_current }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.cpu_current }}%
                                                    </div>
                                                </div>
                                            </td>

                                        {% elif device.cpu_current >= 0 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-success"
                                                         role="progressbar" style="width: {{ device.cpu_current }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.cpu_current }}%
                                                    </div>
                                                </div>
                                            </td>

                                        {% else %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-danger"
                                                         role="progressbar" style="width: 100%" aria-valuenow="25"
                                                         aria-valuemin="0" aria-valuemax="100">{{ device.cpu_current }}%
                                                    </div>
                                                </div>
                                            </td>

                                        {% endif %}

                                        {# 根据最大内存利用率, 调整进度条颜色与长度 #}
                                        {% if device.mem_max >= 70 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    {# progress-bar为进度条, bg-danger为颜色, width为长度, <div>中间</div>为进度条内显示的内容 #}
                                                    <div class="progress-bar progress-bar-striped bg-danger"
                                                         role="progressbar" style="width: {{ device.mem_max }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.mem_max }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% elif device.mem_max >= 30 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-warning"
                                                         role="progressbar" style="width: {{ device.mem_max }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.mem_max }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% elif device.mem_max >= 0 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-success"
                                                         role="progressbar" style="width: {{ device.mem_max }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.mem_max }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% else %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-danger"
                                                         role="progressbar" style="width: 100%" aria-valuenow="25"
                                                         aria-valuemin="0" aria-valuemax="100">{{ device.mem_max }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% endif %}

                                        {# 根据当前内存利用率, 调整进度条颜色与长度 #}
                                        {% if device.mem_current >= 70 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    {# progress-bar为进度条, bg-danger为颜色, width为长度, <div>中间</div>为进度条内显示的内容 #}
                                                    <div class="progress-bar progress-bar-striped bg-danger"
                                                         role="progressbar" style="width: {{ device.mem_current }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.mem_current }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% elif device.mem_current >= 30 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-warning"
                                                         role="progressbar" style="width: {{ device.mem_current }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.mem_current }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% elif device.mem_current >= 0 %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-success"
                                                         role="progressbar" style="width: {{ device.mem_current }}%"
                                                         aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">{{ device.mem_current }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% else %}
                                            <td align="center" valign="center">
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped bg-danger"
                                                         role="progressbar" style="width: 100%" aria-valuenow="25"
                                                         aria-valuemin="0" aria-valuemax="100">{{ device.mem_current }}%
                                                    </div>
                                                </div>
                                            </td>
                                        {% endif %}
                                        <td align="center" valign="center">{{ device.ifs }}</td>

                                        <td align="center" valign="center">
                                            <a href="{{ device.id_delete }}"
                                               onclick="return confirmAct();"
                                               data-toggle="tooltip" data-placement="top"
                                               title="删除此设备"
                                               class="badge badge-danger">删除</a>

                                            <a href="{{ device.id_edit }}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="编辑此设备"
                                               class="badge badge-success">编辑</a>
                                        </td>

                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- Top Bar End -->
            </div>
        </div>
    </div>

    {# 渲染DataTable #}
    <script type="text/javascript">
        $(document).ready(function () {

            //Buttons examples
            var table = $('#datatable-buttons').DataTable({
                lengthChange: false,
                buttons: ['copy', 'excel', 'pdf']
            });
            $('#datatable-buttons tbody').on('click', 'tr', function () {
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected');
                }
                else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            });

            table.buttons().container()
                .appendTo('#datatable-buttons_wrapper .col-md-6:eq(0)');
        });

    </script>

    {# 提示删除确认警告的JavaScript #}
    <script type="text/javascript" language="javascript">
        <!--
        function confirmAct() {
            if (confirm('确定要执行此删除操作吗?')) {
                return true;
            }
            return false;
        }

        //-->
    </script>

{% endblock body %}